function EKLoaderItem(a,b,c,d,e){this.isKilled=false;this.url=a;this.type=c;this.onLoadedFunc=b;this.started=false;this.loaded=false;this.source={};this.data=d;this.percentage=0;this.onLoadedListenerFunc=null;this.onLoadingListenerFunc=null;this.weight=e;this.standalone=false}var EKLoader=new function(){var a=["jpg","png","apng","tiff","svg","jpeg","pnga","gif"];var b=["txt","htm","html","xml"];var c=["mp3","ogg"];var d=["js"];var e=["audio/mpeg","audio/ogg"];var f=[["mp4","mpeg","mpg"],["ogv","oga"],["dvx","divx","xdiv"]];var g=["video/mp4","video/ogg","video/divx"];this.TYPE_IMAGE="IMAGE";this.TYPE_TEXT="TEXT";this.TYPE_JSON="JSON";this.TYPE_JSONP="JSONP";this.TYPE_JS="JS";this.TYPE_AUDIO="AUDIO";this.TYPE_VIDEO="VIDEO";var h=[];var i={};var j=null;var k=null;this.weightSum=0;var l=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return true;return false};this.resetListeners=function(a,b){var c=[];while(h[0]){if(h[0].started){h[0].isKilled=true}else{c.unshift(h[0])}h.shift()}h=c;this.weightSum=0;j=a;k=b};this.get=function(a){return i[a]};this.getSource=function(a){return i[a].source};this.singleLoad=function(a,b,c,d,e){var f=m(a,b,c,d,e,1);f.standalone=true;n(f);return f};this.add=function(a,b,c,d,e,f){var g=f||1;this.weightSum+=g;h[h.length]=i[a]=m(a,b,c,d,e,g);return true};var m=function(h,j,k,m,n,o){if(!k){var p=h.split(".").pop().toLowerCase();k=l(a,p)?EKLoader.TYPE_IMAGE:l(b,p)?EKLoader.TYPE_TEXT:l(d,p)?EKLoader.TYPE_JS:undefined;var q="";if(!k){var r=c.length;while(r--){if(p==c[r]){k=EKLoader.TYPE_AUDIO;q=e[r];break}}if(!k){var s=f.length;while(s--){r=f[s].length;while(r--){if(f[s][r]==p){k=EKLoader.TYPE_VIDEO;q=g[s];break}}if(k)break}}if(!k){throw"File type not found."}}}if(i[h]){if(k==EKLoader.TYPE_IMAGE){if(i[h].loaded){i[h].source=new Image;i[h].source.src=h;if(j)j(i[h])}}else{throw"File already exists."}}var t=new EKLoaderItem(h,j,k,n,o);if(q!="")t.mime=t.mime=q;return t};this.start=function(){var a;var b=h.length;for(var c=0;c<b;c++){n(h[c])}};var n=function(a){if(!a.started){a.started=true;switch(a.type){case EKLoader.TYPE_IMAGE:p(a);break;case EKLoader.TYPE_TEXT:case EKLoader.TYPE_JSON:q(a);break;case EKLoader.TYPE_JS:r(a);break;case EKLoader.TYPE_AUDIO:s(a);break;case EKLoader.TYPE_VIDEO:t(a);break;case EKLoader.TYPE_JSONP:o(a);break}}};var o=function(a){var b="_jsonp"+(new Date).getTime()+parseInt((new Date).getTime()*Math.random());window[b]=function(b){a.source=b;w(a)};var c=document.createElement("script");c.type="text/javascript";c.src=a.url+b;document.getElementsByTagName("head")[0].appendChild(c)};var p=function(a){a.source=new Image;a.source.src=a.url;if(a.source.width==0){a.source.onload=function(){a.source.onload=null;w(a)}}else{w(a)}};var q=function(a){function d(){if(b.readyState==4){if(b.status==200){a.source=c?typeof JSON!="undefined"?JSON.parse(b.responseText.toString()):(new Function("return "+b.responseText.toString()))():b.responseText;w(a)}else{}}}var b;var c=a.type==EKLoader.TYPE_JSON;if(window.XMLHttpRequest){b=new XMLHttpRequest;b.onreadystatechange=d;b.open("GET",a.url,true);b.send(null)}else if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP");if(b){b.onreadystatechange=d;b.open("GET",a.url,true);b.send()}}};var r=function(a){a.source=document.createElement("script");a.source.type="text/javascript";if(a.source.readyState){a.source.onreadystatechange=function(){if(a.source.readyState=="loaded"||a.source.readyState=="complete"){a.source.onreadystatechange=null;w(a)}}}else{a.source.onload=function(){w(a)}}a.source.src=a.url;document.getElementsByTagName("head")[0].appendChild(a.source)};var s=function(a){try{a.source=new Audio}catch(b){a.source=document.createElement("audio")}a.source.progress=a.onLoadingListenerFunc=function(){u(a)};a.source.canplaythrough=a.source.load=a.onLoadedListenerFunc=function(){v(a)};a.source.src=a.url;a.source.load()};var t=function(a){try{a.source=new Video}catch(b){a.source=document.createElement("video")}a.source.progress=a.onLoadingListenerFunc=function(){u(a)};a.source.canplaythrough=a.source.load=a.onLoadedListenerFunc=function(){v(a)};a.source.src=a.url;a.source.load()};var u=function(a){if(a.isKilled)return;if(a.source.buffered!=undefined)if(a.source.buffered.length>0){a.percentage=a.source.buffered.end(0)/a.source.duration;if(j)j(EKLoader.getPercentage())}};var v=function(a){a.source.canplaythrough=a.source.load=a.source.progress=null;w(a)};var w=function(a){a.loaded=true;switch(a.type){case EKLoader.TYPE_IMAGE:break;case EKLoader.TYPE_TEXT:break;case EKLoader.TYPE_JS:break;case EKLoader.TYPE_AUDIO:break;case EKLoader.TYPE_VIDEO:break}a.percentage=1;if(a.isKilled)return;if(j)j(EKLoader.getPercentage());if(a.onLoadedFunc)a.onLoadedFunc(a);if(!a.standalone)if(EKLoader.getPercentage()==1){j=null;if(k){var b=k;k=null;b()}}};this.getPercentage=function(){var a=0;var b=h.length;for(var c=0;c<b;c++){a+=h[c].percentage*h[c].weight}return a/EKLoader.weightSum};this.setOnLoad=function(a){w(a)}}